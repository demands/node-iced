#!/usr/bin/env node

// Generated by CoffeeScript 1.6.3
var columnify, filesize, glacier, knownOpts, nopt, parsedOptions, shortHands;

exports.command = {
  description: 'Manages the vaults in an Amazon Glacier account.'
};

if (require.main === module) {
  glacier = require('../lib/glacier');
  columnify = require('columnify');
  filesize = require('filesize');
  nopt = require('nopt');
  knownOpts = {
    create: String
  };
  shortHands = {
    c: ['--create']
  };
  parsedOptions = nopt(knownOpts, shortHands, process.argv);
  if (parsedOptions.create != null) {
    glacier.createVault({
      vaultName: parsedOptions.create
    }, function(err, data) {
      return console.log("Created new vault " + parsedOptions.create);
    });
  } else {
    glacier.listVaults(function(err, data) {
      var vaults;
      if (err != null) {
        console.error(err.message);
        process.exit(1);
      }
      if (data.VaultList.length === 0) {
        console.error("No vaults found");
        process.exit(0);
      }
      vaults = data.VaultList.map(function(vault) {
        var _ref;
        return {
          name: vault.VaultName,
          created: vault.CreationDate,
          archives: vault.NumberOfArchives,
          size: filesize((_ref = vault.SizeInBytes) != null ? _ref : 0)
        };
      });
      console.log(columnify(vaults));
      return process.exit(0);
    });
  }
}
